<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Payment</title>
	<style>
		body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f6f7fb;color:#222}
		.container{max-width:720px;margin:24px auto;background:#fff;border:1px solid #e6e8ef;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
		.header{padding:16px 20px;border-bottom:1px solid #e6e8ef;display:flex;justify-content:space-between;align-items:center}
		.section{padding:16px 20px}
		.btn{background:#1f6feb;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
		.btn.secondary{background:#e9eef6;color:#214}
		.row{display:flex;gap:8px}
		.input{padding:10px;border:1px solid #d6dae3;border-radius:6px;width:100%}
		.small{font-size:12px;color:#666}
	</style>
</head>
<body>
	<div class="container">
		<div class="header"><h2>Mock Payment</h2><a href="/mytransfers/public/my-bookings.html" class="small">My Bookings</a></div>
		<div class="section">
			<div id="summary" class="small">Loading booking...</div>
		</div>
		<div class="section">
			<div class="row">
				<button class="btn" id="payBtn">Pay</button>
				<button class="btn secondary" id="cancelBtn">Cancel</button>
			</div>
			<div id="result" class="small" style="margin-top:10px"></div>
		</div>
	</div>
	<script>
	(function(){
		function q(k){return new URLSearchParams(location.search).get(k)||''}
		const booking_id=q('booking_id');
		const summary=document.getElementById('summary');
		const result=document.getElementById('result');
		if(!booking_id){summary.textContent='Missing booking_id';return;}
		fetch(`/mytransfers/api/booking?booking_id=${encodeURIComponent(booking_id)}`)
		.then(r=>r.json()).then(d=>{
			if(d.error){summary.textContent=d.error;return}
			summary.textContent=`Booking ${d.booking_id} | Amount: ${d.amount?.amount} ${d.amount?.currency||'EUR'} | Status: ${d.status}`
		})
		.catch(()=>{summary.textContent='Failed to load booking';});

		document.getElementById('payBtn').onclick=()=>{
			fetch('/mytransfers/api/payment/confirm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({booking_id})})
			.then(r=>r.json()).then(()=>{
				result.textContent='Payment successful. Redirecting to voucher...';
				setTimeout(async ()=>{
					const tk = await fetch(`/mytransfers/api/voucher/token?booking_id=${encodeURIComponent(booking_id)}`).then(r=>r.json()).catch(()=>({}));
					const token = tk.token||'';
					window.location.href=`/mytransfers/public/voucher.html?booking_id=${encodeURIComponent(booking_id)}&token=${encodeURIComponent(token)}`;
				},800);
			});
		};
		document.getElementById('cancelBtn').onclick=()=>{
			fetch('/mytransfers/api/payment/cancel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({booking_id})})
			.then(r=>r.json()).then(()=>{
				result.textContent='Payment canceled.';
			});
		};
	})();
	</script>
</body>
</html>


