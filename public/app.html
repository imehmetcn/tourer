<!doctype html>
<html lang="en" ng-app="app">
<head>
    <meta charset="utf-8" />
    <title>MyTransfers Demo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 24px; }
        input, button, select { padding: 8px; margin-right: 8px; }
        .card { border: 1px solid #ddd; padding: 12px; margin: 8px 0; }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="noindex, nofollow" />
    <meta charset="utf-8" />
</head>
<body ng-controller="MainCtrl">

    <h2>Search</h2>
    <input ng-model="query" placeholder="Airport or city..." />
    <select ng-model="lang">
        <option value="en">en</option>
        <option value="es">es</option>
        <option value="fr">fr</option>
        <option value="de">de</option>
    </select>
    <button ng-click="search()">Search</button>

    <div ng-if="loading">Loading...</div>
    <div ng-if="error" style="color: red;">{{error}}</div>

    <div ng-repeat="r in results" class="card">
        <div><b>{{r.vehicle.type}}</b> - {{r.price.amount}} {{r.price.currency}}</div>
        <div>{{r.pickup.name}} â†’ {{r.dropoff.name}}</div>
        <button ng-click="book(r)">Book</button>
    </div>

    <h2>Booking</h2>
    <pre ng-if="booking">{{booking | json}}</pre>

<script>
angular.module('app', [])
.controller('MainCtrl', function($scope, $http) {
    $scope.lang = 'en';
    $scope.query = 'Madrid';
    $scope.results = [];
    $scope.loading = false;
    $scope.error = null;

    $scope.search = function() {
        $scope.loading = true;
        $scope.error = null;
        $http.get('/api/search', { params: { lang: $scope.lang, query: $scope.query }})
            .then(function(res) {
                $scope.results = res.data.results || [];
            })
            .catch(function(err) {
                $scope.error = (err.data && err.data.error) || 'Search failed';
            })
            .finally(function() {
                $scope.loading = false;
            });
    };

    $scope.book = function(offer) {
        const payload = {
            pickup_date: new Date().toISOString(),
            return_date: new Date(Date.now() + 3*3600*1000).toISOString(),
            passengers: 2,
            pickup: offer.pickup,
            dropoff: offer.dropoff,
            offer_id: offer.id
        };
        $http.post('/api/book', payload, { headers: { 'Content-Type': 'application/json' } })
            .then(function(res) {
                $scope.booking = res.data;
            })
            .catch(function(err) {
                $scope.booking = { error: (err.data && err.data.error) || 'Booking failed' };
            });
    };
});
</script>
</body>
</html>


